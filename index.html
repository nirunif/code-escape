<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Code Escape â€“ Pixel Cyber Puzzle Game</title>

  <!-- Pixel Font -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    :root {
      --neon-cyan: #22d3ee;
      --neon-pink: #fb37ff;
      --terminal-green: #4ade80;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%),
                  repeating-linear-gradient(90deg, rgba(148, 163, 184, 0.1) 0, rgba(148, 163, 184, 0.1) 1px, transparent 1px, transparent 3px);
      background-attachment: fixed;
    }

    .pixel-font {
      font-family: 'Press Start 2P', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      letter-spacing: 0.08em;
    }

    .scanlines::before {
      content: "";
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.6) 0,
        rgba(15, 23, 42, 0.6) 1px,
        rgba(15, 23, 42, 0.2) 1px,
        rgba(15, 23, 42, 0.2) 3px
      );
      mix-blend-mode: soft-light;
      pointer-events: none;
      opacity: 0.8;
    }

    .pixel-border {
      box-shadow:
        0 0 0 2px #0f172a,
        0 0 0 4px #22d3ee,
        0 0 32px rgba(34, 211, 238, 0.45);
    }

    .neon-text {
      text-shadow:
        0 0 4px rgba(34, 211, 238, 0.9),
        0 0 12px rgba(34, 211, 238, 0.8),
        0 0 24px rgba(251, 55, 255, 0.6);
    }

    .crt-glow {
      box-shadow:
        0 0 30px rgba(34, 211, 238, 0.45),
        0 0 70px rgba(251, 55, 255, 0.35);
    }

    .pixel-btn {
      image-rendering: pixelated;
      box-shadow:
        0 0 0 2px #020617,
        0 0 0 4px #0f172a,
        0 0 18px rgba(34, 211, 238, 0.4);
    }

    .pixel-btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow:
        0 0 0 2px #020617,
        0 0 0 3px #0f172a,
        0 0 12px rgba(34, 211, 238, 0.3);
    }

    .terminal-text {
      font-family: "Fira Code", "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      text-shadow:
        0 0 6px rgba(74, 222, 128, 0.7),
        0 0 14px rgba(34, 197, 94, 0.5);
    }

    .locked-icon {
      filter: drop-shadow(0 0 6px rgba(148, 163, 184, 0.7));
    }

    .unlocked-icon {
      filter: drop-shadow(0 0 8px rgba(34, 211, 238, 0.9));
    }

    .fade-in {
      animation: fadeIn 260ms ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>

  <!-- Tailwind CSS v4 via CDN (browser runtime) -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="min-h-screen text-slate-100 flex items-center justify-center p-4">
  <main class="relative w-full max-w-5xl scanlines">
    <div class="relative pixel-border crt-glow rounded-xl bg-slate-950/80 ring-1 ring-cyan-400/60 overflow-hidden">
      <!-- Header -->
      <header class="border-b border-cyan-400/40 bg-slate-950/60 px-6 sm:px-8 py-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h1 class="pixel-font neon-text text-xl sm:text-2xl text-cyan-300 tracking-[0.2em] uppercase">
            Code Escape
          </h1>
          <p class="mt-2 text-xs sm:text-sm text-cyan-100/80 max-w-xl">
            Hack through 5 terminal puzzles. Each correct answer unlocks the next level. Type carefullyâ€”your escape key is your brain.
          </p>
        </div>
        <div class="mt-1 sm:mt-0 flex flex-col items-start sm:items-end gap-1 text-[10px] sm:text-xs text-right text-cyan-100/60">
          <span class="terminal-text text-terminal-green/80">// MODE: PIXEL-CYBER</span>
          <span class="terminal-text">SESSION_ID: <span id="session-id" class="text-cyan-300"></span></span>
        </div>
      </header>

      <!-- Content -->
      <section class="grid grid-cols-1 md:grid-cols-4 gap-4 sm:gap-6 px-4 sm:px-6 py-5 sm:py-6">
        <!-- Levels Sidebar -->
        <aside class="md:col-span-1">
          <h2 class="pixel-font text-[10px] text-cyan-200 tracking-[0.25em] uppercase mb-3">
            Levels
          </h2>
          <div id="levels-list" class="space-y-2 text-xs"></div>

          <div class="mt-4 border border-cyan-500/30 bg-slate-900/80 rounded-lg px-3 py-3 text-[10px] text-cyan-100/70">
            <p class="terminal-text text-[10px] leading-relaxed mb-1">PROTOCOL:</p>
            <ul class="list-disc list-inside space-y-1">
              <li>Only <span class="text-terminal-green">Level 1</span> is unlocked.</li>
              <li>Solve the puzzle. Hit <span class="text-terminal-green">ENTER</span>.</li>
              <li>Each success unlocks the next node.</li>
              <li>Progress is auto-saved in this browser.</li>
            </ul>
          </div>
        </aside>

        <!-- Game Panel -->
        <section class="md:col-span-3 flex flex-col gap-4">
          <div class="border border-cyan-500/40 bg-slate-950/90 rounded-xl p-4 sm:p-5 flex flex-col gap-4">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="pixel-font text-[10px] tracking-[0.25em] text-cyan-400 uppercase">Active Node</p>
                <h2 id="level-title" class="mt-1 text-lg sm:text-xl font-semibold text-cyan-100">
                  Level 1 â€“ Boot Sequence
                </h2>
              </div>
              <div class="text-right text-xs">
                <p class="text-cyan-300">Progress</p>
                <p id="progress-text" class="font-mono text-cyan-100">0 / 5 cleared</p>
              </div>
            </div>

            <!-- Prompt -->
            <div class="border border-cyan-500/30 rounded-lg bg-gradient-to-b from-slate-900/70 to-slate-950/80 px-3 sm:px-4 py-3 sm:py-4">
              <p class="pixel-font text-[10px] tracking-[0.25em] text-cyan-300/90 uppercase mb-2">
                Puzzle
              </p>
              <pre id="level-prompt" class="terminal-text text-[11px] sm:text-xs text-terminal-green/90 whitespace-pre-wrap"></pre>
            </div>

            <!-- Input / Controls -->
            <div class="flex flex-col gap-3">
              <label for="answer-input" class="pixel-font text-[10px] tracking-[0.25em] text-cyan-300/80 uppercase">
                Console Input
              </label>
              <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 items-stretch">
                <input
                  id="answer-input"
                  type="text"
                  autocomplete="off"
                  class="w-full rounded-lg border border-cyan-500/40 bg-slate-950/80 px-3 py-2 text-xs sm:text-sm text-cyan-50 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-cyan-400/80 focus:border-cyan-300/80 terminal-text"
                  placeholder="Type your answer and press ENTER or SUBMIT..."
                />
                <button
                  id="submit-btn"
                  class="pixel-btn relative overflow-hidden inline-flex items-center justify-center rounded-lg bg-cyan-500/90 px-4 py-2 text-xs sm:text-sm font-semibold text-slate-950 hover:bg-cyan-300/90 transition-colors">
                  <span class="pixel-font text-[9px] sm:text-[10px] tracking-[0.18em] uppercase">Submit</span>
                </button>
              </div>
              <div class="flex justify-between items-center text-[10px] text-slate-400">
                <p>Hint: punctuation and capitalization might matter.</p>
                <button id="hint-btn" class="text-cyan-300 hover:text-cyan-100 underline-offset-2 hover:underline">
                  Need a hint?
                </button>
              </div>
            </div>

            <!-- Feedback / Log -->
            <div class="border border-cyan-500/30 bg-slate-950/80 rounded-lg px-3 sm:px-4 py-3 sm:py-3.5">
              <div class="flex items-center justify-between mb-2">
                <p class="pixel-font text-[10px] tracking-[0.25em] text-cyan-300/80 uppercase">
                  System Log
                </p>
                <button id="clear-log-btn" class="text-[10px] text-slate-400 hover:text-slate-200 underline-offset-2 hover:underline">
                  clear
                </button>
              </div>
              <div id="log-output" class="terminal-text text-[11px] sm:text-xs text-terminal-green/80 space-y-1 max-h-32 overflow-y-auto">
                <p>> session initialized. select a level to beginâ€¦</p>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <footer class="text-[10px] sm:text-xs text-slate-400 flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between px-1 pb-1">
            <div class="flex flex-wrap gap-2 items-center">
              <span class="pixel-font text-[9px] tracking-[0.2em] uppercase text-cyan-500">Controls</span>
              <span>ENTER / SUBMIT = run code</span>
              <span>CLICK LEVEL = switch node (if unlocked)</span>
            </div>
            <div class="flex flex-wrap gap-2 items-center justify-between sm:justify-end">
              <button id="reset-btn" class="text-rose-400 hover:text-rose-300 underline-offset-2 hover:underline">
                reset progress
              </button>
              <span class="text-slate-500">v1.0 â€“ Code Escape</span>
            </div>
          </footer>
        </section>
      </section>
    </div>
  </main>

  <script>
    // ---------------------------
    // Sound System
    // ---------------------------
    class SoundSystem {
      constructor() {
        this.audioContext = null;
      }

      init() {
        if (!this.audioContext) {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
      }

      playSuccess() {
        this.init();
        const ctx = this.audioContext;
        const oscillator1 = ctx.createOscillator();
        const oscillator2 = ctx.createOscillator();
        const gainNode = ctx.createGain();
        
        oscillator1.connect(gainNode);
        oscillator2.connect(gainNode);
        gainNode.connect(ctx.destination);
        
        // Mario coin-like sound
        oscillator1.frequency.setValueAtTime(523.25, ctx.currentTime); // C5
        oscillator1.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1); // E5
        oscillator1.frequency.setValueAtTime(783.99, ctx.currentTime + 0.2); // G5
        
        oscillator2.frequency.setValueAtTime(659.25, ctx.currentTime); // E5
        oscillator2.frequency.setValueAtTime(783.99, ctx.currentTime + 0.1); // G5
        oscillator2.frequency.setValueAtTime(1046.50, ctx.currentTime + 0.2); // C6
        
        oscillator1.type = 'square';
        oscillator2.type = 'square';
        
        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        
        oscillator1.start(ctx.currentTime);
        oscillator2.start(ctx.currentTime);
        oscillator1.stop(ctx.currentTime + 0.3);
        oscillator2.stop(ctx.currentTime + 0.3);
      }

      playError() {
        this.init();
        const ctx = this.audioContext;
        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);
        
        // Mario death-like descending sound
        oscillator.frequency.setValueAtTime(400, ctx.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.5);
        
        oscillator.type = 'square';
        
        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
        
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.5);
      }
    }

    const soundSystem = new SoundSystem();

    // ---------------------------
    // Game Data
    // ---------------------------
    const levels = [
      {
        id: 1,
        title: 'Level 1  Boot Sequence',
        prompt: [
          'Your terminal is waking up. To start the system, you must lock in a value that cannot change.',
          '',
          'In JavaScript, which keyword creates a variable that cannot be reassigned?',
          '',
          'Example:',
          '  // create a constant answer to life',
          '  ? answer = 42;',
          '',
          'Type the missing keyword.'
        ].join('\n'),
        placeholder: 'Type the keyword (hint: 5 letters)...',
        hint: 'There are three ways: var, let, and ?. You want the one used for constants.',
        validate(input) {
          return input.trim().toLowerCase() === 'const';
        }
      },
      {
        id: 2,
        title: 'Level 2  Type Glitch',
        prompt: [
          'The console is glitching numbers and strings together.',
          '',
          'What will this code print?',
          '',
          '  console.log(2 + "2");',
          '',
          'Type exactly what appears in the console.'
        ].join('\n'),
        placeholder: 'What is logged?',
        hint: 'When you add a number to a string, JavaScript glues them together.',
        validate(input) {
          return input.trim() === '22';
        }
      },
      {
        id: 3,
        title: 'Level 3  Logic Gate',
        prompt: [
          'A simple circuit is missing its operator.',
          '',
          'Complete the expression so that it evaluates to true:',
          '',
          '  3  ?  4 === 12',
          '',
          'Type the missing symbol only.'
        ].join('\n'),
        placeholder: 'Type one operator symbol...',
        hint: 'You want 3 times 4 to get 12.',
        validate(input) {
          return input.trim() === '*';
        }
      },
      {
        id: 4,
        title: 'Level 4  Binary Gate',
        prompt: [
          'The firewall speaks in binary. Decode the key.',
          '',
          'What is the decimal (base 10) value of the binary number 1010 (base 2)?',
          '',
          'Type the number only.'
        ].join('\n'),
        placeholder: 'Convert 1010 to decimal...',
        hint: 'From right to left: 1, 2, 4, 8 ... only positions with a 1 count.',
        validate(input) {
          return input.trim() === '10';
        }
      },
      {
        id: 5,
        title: 'Level 5  Escape Vector',
        prompt: [
          'Final gate: manipulate the array, escape the system.',
          '',
          'Which JavaScript array method adds an element to the END of an array?',
          '',
          'Choices: push, pop, shift',
          '',
          'Type the method name only.'
        ].join('\n'),
        placeholder: 'Type: push, pop, or shift...',
        hint: 'Think of pushing a value onto the back of a line.',
        validate(input) {
          return input.trim().toLowerCase() === 'push';
        }
      }
    ];

    const TOTAL_LEVELS = levels.length;
    const STORAGE_KEY = 'code-escape-progress-v1';

    // ---------------------------
    // DOM Helpers
    // ---------------------------
    const $ = (sel) => document.querySelector(sel);

    const elements = {
      levelsList: $('#levels-list'),
      levelTitle: $('#level-title'),
      levelPrompt: $('#level-prompt'),
      answerInput: $('#answer-input'),
      submitBtn: $('#submit-btn'),
      hintBtn: $('#hint-btn'),
      logOutput: $('#log-output'),
      progressText: $('#progress-text'),
      resetBtn: $('#reset-btn'),
      clearLogBtn: $('#clear-log-btn'),
      sessionId: $('#session-id')
    };

    // ---------------------------
    // State
    // ---------------------------
    let state = {
      unlockedLevels: 1,
      clearedLevels: 0,
      activeLevelId: 1
    };

    // ---------------------------
    // Persistence
    // ---------------------------
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const saved = JSON.parse(raw);
        if (typeof saved.unlockedLevels === 'number' && typeof saved.clearedLevels === 'number') {
          state.unlockedLevels = Math.min(TOTAL_LEVELS, Math.max(1, saved.unlockedLevels));
          state.clearedLevels = Math.min(TOTAL_LEVELS, Math.max(0, saved.clearedLevels));
          if (typeof saved.activeLevelId === 'number') {
            state.activeLevelId = Math.min(TOTAL_LEVELS, Math.max(1, saved.activeLevelId));
          }
        }
      } catch (e) {
        console.warn('Failed to load game state', e);
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.warn('Failed to save game state', e);
      }
    }

    function resetState() {
      state = { unlockedLevels: 1, clearedLevels: 0, activeLevelId: 1 };
      saveState();
      renderAll();
      appendLog('> progress reset. system rebooted.');
    }

    // ---------------------------
    // Rendering
    // ---------------------------
    function renderLevelsList() {
      elements.levelsList.innerHTML = '';
      levels.forEach((level) => {
        const isUnlocked = level.id <= state.unlockedLevels;
        const isCleared = level.id <= state.clearedLevels;
        const isActive = level.id === state.activeLevelId;

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = [
          'w-full flex items-center justify-between gap-2 px-3 py-2 rounded-lg text-left transition-colors border',
          'pixel-btn bg-slate-950/80',
          isActive ? 'border-cyan-400/70 bg-cyan-950/40' : 'border-slate-700/70 hover:border-cyan-400/60 hover:bg-slate-900/80',
          !isUnlocked ? 'opacity-60 cursor-not-allowed' : 'cursor-pointer'
        ].join(' ');

        btn.dataset.levelId = level.id;

        const left = document.createElement('div');
        left.className = 'flex flex-col';

        const label = document.createElement('span');
        label.className = 'pixel-font text-[9px] tracking-[0.22em] uppercase text-cyan-200';
        label.textContent = `Node ${String(level.id).padStart(2, '0')}`;

        const title = document.createElement('span');
        title.className = 'text-[11px] text-slate-100';
        title.textContent = level.title.split(' â€“ ')[1] || level.title;

        left.appendChild(label);
        left.appendChild(title);

        const right = document.createElement('div');
        right.className = 'flex items-center gap-1 text-xs';

        const icon = document.createElement('span');
        icon.className = isUnlocked ? 'unlocked-icon text-cyan-300' : 'locked-icon text-slate-400';
        icon.textContent = isUnlocked ? (isCleared ? 'â—†' : 'â—‡') : 'â›”';

        const status = document.createElement('span');
        status.className = 'text-[10px] text-slate-400';
        status.textContent = !isUnlocked ? 'Locked' : (isCleared ? 'Cleared' : 'Ready');

        right.appendChild(icon);
        right.appendChild(status);

        btn.appendChild(left);
        btn.appendChild(right);

        if (isUnlocked) {
          btn.addEventListener('click', () => {
            if (state.activeLevelId !== level.id) {
              state.activeLevelId = level.id;
              saveState();
              renderActiveLevel();
              appendLog(`> switched to node ${level.id}.`);
            }
          });
        }

        elements.levelsList.appendChild(btn);
      });
    }

    function renderActiveLevel() {
      const active = levels.find((l) => l.id === state.activeLevelId) || levels[0];

      elements.levelTitle.textContent = active.title;
      elements.levelPrompt.textContent = active.prompt;
      elements.answerInput.value = '';
      elements.answerInput.placeholder = active.placeholder || '';
      elements.answerInput.focus();

      elements.progressText.textContent = `${state.clearedLevels} / ${TOTAL_LEVELS} cleared`;
    }

    function renderSessionId() {
      // Just create a short pseudo-random id for flavor
      const existing = sessionStorage.getItem('code-escape-session-id');
      let id = existing;
      if (!id) {
        const t = Date.now().toString(16).slice(-4);
        const r = Math.floor(Math.random() * 0xffff).toString(16).padStart(4, '0');
        id = `${t}:${r}`;
        sessionStorage.setItem('code-escape-session-id', id);
      }
      elements.sessionId.textContent = id;
    }

    function renderAll() {
      renderLevelsList();
      renderActiveLevel();
      renderSessionId();
    }

    // ---------------------------
    // Log / Feedback
    // ---------------------------
    function appendLog(message, options = {}) {
      const { type = 'info' } = options;
      const p = document.createElement('p');
      p.className = 'fade-in';
      let prefix = '>';
      let colorClass = 'text-terminal-green/80';
      if (type === 'error') {
        prefix = '!';
        colorClass = 'text-rose-400/90';
      } else if (type === 'success') {
        prefix = 'âœ”';
        colorClass = 'text-cyan-300';
      } else if (type === 'hint') {
        prefix = '?';
        colorClass = 'text-amber-300/90';
      }
      p.classList.add(colorClass.replace('/', '-')); // Tailwind-safe basic color
      p.textContent = `${prefix} ${message}`;
      elements.logOutput.appendChild(p);
      elements.logOutput.scrollTop = elements.logOutput.scrollHeight;
    }

    function clearLog() {
      elements.logOutput.innerHTML = '';
      appendLog('log cleared. awaiting input...');
    }

    // ---------------------------
    // Game Logic
    // ---------------------------
    function getActiveLevel() {
      return levels.find((l) => l.id === state.activeLevelId) || levels[0];
    }

    function handleSubmit() {
      const level = getActiveLevel();
      const raw = elements.answerInput.value;
      const input = raw.trim();

      if (!input) {
        appendLog('no input detected. type an answer first.', { type: 'error' });
        elements.answerInput.focus();
        return;
      }

      appendLog(`input[${level.id}]: "${input}"`);

      let isCorrect = false;
      try {
        isCorrect = !!level.validate(input);
      } catch (e) {
        console.error('Validation error', e);
      }

      if (!isCorrect) {
        soundSystem.playError();
        appendLog('access denied. incorrect answer.', { type: 'error' });
        return;
      }

      soundSystem.playSuccess();
      appendLog('access granted. puzzle solved.', { type: 'success' });

      if (level.id > state.clearedLevels) {
        state.clearedLevels = level.id;
      }

      if (state.unlockedLevels < TOTAL_LEVELS && level.id === state.unlockedLevels) {
        state.unlockedLevels = level.id + 1;
        appendLog(`node ${state.unlockedLevels} unlocked.`, { type: 'success' });
      }

      saveState();
      renderLevelsList();
      elements.progressText.textContent = `${state.clearedLevels} / ${TOTAL_LEVELS} cleared`;

      if (state.clearedLevels === TOTAL_LEVELS) {
        appendLog('all nodes cleared. escape sequence complete. ðŸŽ‰', { type: 'success' });
      }
    }

    function showHint() {
      const level = getActiveLevel();
      if (!level.hint) {
        appendLog('no hint available for this node.', { type: 'hint' });
        return;
      }
      appendLog(level.hint, { type: 'hint' });
    }

    // ---------------------------
    // Event Wiring
    // ---------------------------
    function wireEvents() {
      elements.submitBtn.addEventListener('click', handleSubmit);
      elements.hintBtn.addEventListener('click', showHint);
      elements.resetBtn.addEventListener('click', () => {
        if (confirm('Reset all progress and relock levels?')) {
          resetState();
        }
      });
      elements.clearLogBtn.addEventListener('click', clearLog);

      elements.answerInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          handleSubmit();
        }
      });
    }

    // ---------------------------
    // Init
    // ---------------------------
    document.addEventListener('DOMContentLoaded', () => {
      loadState();
      renderAll();
      wireEvents();
      appendLog('welcome to CODE ESCAPE. solve node 1 to begin your exit.');
    });
  </script>
</body>
</html>